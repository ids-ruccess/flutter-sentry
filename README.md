# Flutter Sentry Integration

> 내기에서 진 대가로 작성한 선물 같은 프로젝트입니다. 🎁  
> 우리 회사 Flutter 개발자분들께 도움이 되길 바라봅니다! 늘 즐겁게 같이 일해줘서 감사합니다.

## 📝 프로젝트 소개

이 프로젝트는 Flutter 애플리케이션에서 Sentry를 활용한 에러 모니터링과 로깅 시스템을 구현한 예제입니다. 실제 운영 환경에서 발생할 수 있는 다양한 에러 상황을 테스트하고 모니터링할 수 있습니다.

현재 백엔드는 AWS CloudWatch를 사용하고 있으며, ELK 스택 도입을 진행 중입니다. 향후 Flutter 앱의 로그도 ELK 스택과 통합하여 더 강력한 로그 분석 시스템을 구축할 예정입니다. (예측 가능한 선에서는 Sentry를, 조금 더 Custom하여 지표화 하고자 하는 것은 ELK로 함께 해보면 어떨까요?)

## 🎯 Sentry란?

Sentry는 애플리케이션의 에러 모니터링과 성능 모니터링을 제공하는 서비스입니다. 주요 특징은 다음과 같습니다:

- **실시간 에러 모니터링**: 앱에서 발생하는 모든 에러를 실시간으로 감지하고 알림
- **스택 트레이스 분석**: 에러 발생 위치와 원인을 정확하게 파악
- **사용자 컨텍스트**: 에러 발생 시점의 사용자 정보와 환경 정보 제공
- **성능 모니터링**: 앱의 성능 지표를 추적하고 분석
- **릴리즈 트래킹**: 각 버전별 에러 발생 현황 추적

## 💡 왜 Sentry를 사용해야 할까요?

1. **빠른 문제 해결**
   - 에러 발생 즉시 알림
   - 상세한 에러 정보로 빠른 원인 파악
   - 재현이 어려운 에러도 추적 가능

2. **사용자 경험 개선**
   - 실제 사용자들이 겪는 문제를 파악
   - 우선순위가 높은 이슈 파악
   - 앱의 안정성 향상

3. **개발 효율성 (DX: Developer Experience)**
   - **빠른 디버깅**
     - 에러 발생 즉시 알림으로 빠른 대응
     - 상세한 컨텍스트 정보로 원인 파악 용이
     - 재현이 어려운 에러도 추적 가능 (이게 중요하지 않겠습니까? 간지나는 개발자 가능!)
   
   - **개발자 경험 개선**
     - 직관적인 에러 대시보드
     - 에러 패턴 분석으로 예방적 대응
     - 팀 협업 강화 (에러 공유 및 해결)
   
   - **코드 품질 향상**
     - 에러 패턴 기반 코드 개선
     - 자동화된 에러 추적
     - 지속적인 품질 모니터링

## 🛠 구현 시 고려사항

이 프로젝트를 구현하면서 다음과 같은 점들을 고려했습니다:

1. **환경별 설정**
   - 개발(dev): 로컬 로깅만 수행
   - QA: 로컬 로깅만 수행
   - 운영(prod): 중요 에러만 전송

2. **에러 분류**
   - Flutter 프레임워크 에러
   - 네이티브 플랫폼 에러
   - 일반 예외

3. **보안**
   - PII(개인정보) 처리
   - 민감한 정보 필터링

4. **성능**
   - 불필요한 로그 최소화
   - 샘플링 전략
   - 네트워크 부하 고려

5. **초기화 순서**
   - Flutter 엔진 초기화 (`WidgetsFlutterBinding.ensureInitialized()`)
   - 전역 에러 핸들러 설정
   - Sentry 초기화
   - 앱 실행 (`runApp()`)
   - 각 단계별 의존성 고려
   - 초기화 실패 시 대응 방안
     - Sentry 초기화 실패
       - `isInitialized` 플래그로 상태 확인
       - 로컬 로깅으로 자동 전환
       - 환경 정보, 시간, 플랫폼 정보 포함
       - 개발자에게 실패 알림
       
## 🔄 운영 앱 적용 시 고려사항

1. **점진적 도입**
   - 개발 환경에서 먼저 테스트
   - QA 환경에서 검증
   - 운영 환경에 단계적 적용

2. **데이터 관리**
   - 에러 데이터 보관 기간 설정
   - 저장소 비용 고려
   - 데이터 정책 수립

3. **팀 협업**
   - 에러 처리 프로세스 정의
   - 알림 정책 수립

4. **ELK 스택 통합 계획**
   - **현재 상태**
     - 백엔드: AWS CloudWatch 사용 중
     - ELK 스택: 도입 진행 중
   
   - **향후 계획**
     - Flutter 앱 로그를 ELK로 전송하는 구조 설계
     - 로그 포맷 표준화 (JSON 구조)
     - 로그 레벨 및 카테고리 체계화
     - 실시간 로그 모니터링 대시보드 구축

   - **구현 방안**
     - API를 활용한 전송 방식 사용 (아니면 다른 통신방법도 고려해볼 수 있어보임 같이 이야기해보아요)

   - **장점**
     - 백엔드와 동일한 로그 분석 시스템 사용
     - 통합된 로그 검색 및 분석
     - 커스텀 대시보드 구축 가능
     - 실시간 모니터링 강화

   - **고려사항**
     - 로그 전송 시 네트워크 부하
     - 데이터 보관 정책
     - 보안 및 개인정보 처리
     - 비용 최적화

## 💭 로거에 대한 고찰

### 1. 에러 모니터링 도구의 필요성

#### 장점
- 체계적인 에러 관리
- 실시간 모니터링
- 데이터 기반 의사결정
- 사용자 경험 개선

#### 단점
- 추가 비용 발생
- 구현 복잡도 증가
- 데이터 보안 고려사항
- 팀 학습 곡선

### 2. 로그 레벨에 대한 고찰

#### 현재 상황
- **DEBUG**: 개발 중 상세 정보
- **INFO**: 일반적인 정보성 메시지
- **WARNING**: 잠재적 문제 경고
- **ERROR**: 실제 에러 발생
- **FATAL**: 치명적 에러

#### 고민거리
1. **레벨 구분의 모호성**
   - WARNING과 ERROR의 경계가 불명확
   - 개발자마다 다른 기준 적용 가능성
   - 과도한 WARNING 로그 발생

2. **레벨별 처리 전략**
   - 각 레벨별 저장 기간 차등
   - 알림 정책의 차별화
   - 비용 최적화 방안

3. **컨텍스트 정보**
   - 레벨별 필요한 추가 정보
   - 메타데이터 표준화
   - 개인정보 처리 방안

4. **성능 영향**
   - 로그 레벨별 성능 오버헤드
   - 네트워크 부하
   - 저장소 사용량

#### 결론
로그 레벨 체계와 처리 전략에 대해 팀과 함께 검토가 필요해 보입니다. 특히 다음 사항들을 함께 논의하면 좋을 것 같습니다:

- 레벨 구분 기준 명확화
- 레벨별 처리 정책 수립
- 비용과 효율성의 균형
- 팀 내 표준화 방안

## 🚀 사용 방법

1. **초기 설정**
```dart
void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  ErrorHandler();  // 전역 에러 핸들러 설정
  await SentryConfig.init(flavor: Flavor.dev);
  runApp(const MyApp());
}
```

2. **에러 로깅**
```dart
// Flutter 에러
throw FlutterError('에러 메시지');

// 네이티브 에러
throw PlatformException(
  code: 'ERROR_CODE',
  message: '에러 메시지',
);

// 일반 로그
SentryLogger.log(
  '로그 메시지',
  tags: {'action': 'test'},
);
```

3. **사용자 정보 설정**
```dart
SentryLogger.setUser(
  userId: 1111,
  nickName: 'Test User',
  data: {'role': 'admin'},
);
```

## 📚 참고 자료

- [Sentry 공식 문서](https://docs.sentry.io/platforms/flutter/)
- [Flutter 에러 처리 가이드](https://docs.flutter.dev/testing/errors)
- [Dart 비동기 에러 처리](https://dart.dev/guides/language/language-tour#exceptions)

## 💝 마지막으로...

매일 같이 일하면서 느끼는 감사함과 존경심을 전하고 싶어요.
우리 팀의 열정과 전문성, 그리고 서로를 향한 신뢰가 이 프로젝트의 가장 큰 자산입니다.
앞으로도 함께 더 멋진 프로젝트를 만들어가요! 

지피티가 돌려줬어요 하지만 제 진심이에요 알아주세요

진짜 마지막으로... 제가 바라는 점은 궁극적으로 E2E 통합(앱, 백엔드, 프론트엔드) 자동화 함께 해보면 좋지 않을까요? ㅎㅅㅎ

그리고 하나 더! CI/CD 얼른 구축해주세요.... Sentry에 Release Version 자동화도 할 수 있어요... cli 있거든요...? 그러면 그걸 통해서 hotfix 갈지 말지.. rollback 할지말지 데이터로 이야기할 수 있게 되어요... 버전별로 얼마나 박살났는지 알 수 있거든요.....